<!-- <p>{{panel.name}} - {{panel.type}} - {{groupLayout}} - {{bodyOnly}} - {{inline}} - {{panel.subPanels.length}} - {{panel.components.length}} - {{headerComponents.length}} - {{bodyComponents.length}}</p> -->
<ng-container *ngIf="!bodyOnly && panel.type=='group'">
    <div [fxLayout]="groupLayout" fxLayout.xs="column"  fxLayoutGap="0.5%">
        <ng-container *ngFor="let subPanel of panel.subPanels">
            <ng-container *ngIf="subPanel.type!='group'">
                        <kervi-dashboard-panel [fxFlex]="calcWidth(subPanel, true)" [bodyOnly]="true" [inGroup]="true" [dashboardSizes]="dashboardSizes"  [panel]="subPanel"></kervi-dashboard-panel>
            </ng-container>
            <ng-container *ngIf="subPanel.type=='group'">
                    <kervi-dashboard-panel [fxFlex]="calcWidth(subPanel, true)" fxFlex.xs="100"  [inGroup]="true" [dashboardSizes]="dashboardSizes"  [panel]="subPanel"></kervi-dashboard-panel>
            </ng-container>
        </ng-container>
    </div>
</ng-container>

<ng-container *ngIf="!bodyOnly && !inline && panel.type!='group'">
    <kervi-dashboard-panel  [bodyOnly]="true" [dashboardSizes]="dashboardSizes"  [panel]="panel"></kervi-dashboard-panel>
</ng-container>

<ng-container *ngIf="bodyOnly">
    <nz-card [fxFlex]="calcWidth(panel, inGroup)" fxFlex.xs="100%"  [nzTitle]="showHeader ? title : null" [nzExtra]="headerComponents.length>0 ? extraTemplate : null">
        
        <ng-template #extraTemplate>
            <ng-container *ngFor="let panelComponent of headerComponents">
                        <kervi-widget [component]="panelComponent.component" [dashboardPanel]="panel" [inline]="inline"  [linkParameters]="panelComponent.parameters"></kervi-widget>
            </ng-container>
        </ng-template>
        <ng-container *ngFor="let panelComponent of bodyComponents">
            <kervi-widget [component]="panelComponent.component" [dashboardPanel]="panel"  [inline]="inline"  [linkParameters]="panelComponent.parameters"></kervi-widget>
        </ng-container>
    
        <div *ngIf="panel.parameters.userLog"  >
            
            <nz-timeline >
                    <nz-timeline-item [nzDot]="message.level==1 ? dotTemplate1 :  message.level==2 ? dotTemplate2 : dotTemplate3" *ngFor="let message of messages$ | async">
                            <strong>{{message.sourceName}}</strong><br>
                            <span style="font-size:80%">{{message.timestamp | date: 'HH:mm:ss'}}</span><br>    
                            {{message.topic}}
                            <nz-divider></nz-divider>
                    </nz-timeline-item>
            </nz-timeline>
            <ng-template #dotTemplate1>
                    <i nz-icon type="close-circle" style="font-size: 16px;" [nzTheme]="'twotone'" [nzTwotoneColor]="'#f5222d'"></i>
            </ng-template>
            <ng-template #dotTemplate2>
                    <i nz-icon type="warning" style="font-size: 16px;" [nzTheme]="'twotone'" [nzTwotoneColor]="'#faad14'"></i>
            </ng-template>
            <ng-template #dotTemplate3>
                    <i nz-icon nz-icon type="check-circle" [nzTheme]="'twotone'" [nzTwotoneColor]="'#52c41a'" style="font-size: 16px;"></i>
            </ng-template>
        </div> 
    </nz-card>
</ng-container>

<ng-template [ngIf]="!bodyOnly && inline && panel.components.length>0" >
    <ng-container *ngFor="let panelComponent of panel.components" >
        <kervi-widget [component]="panelComponent.component"  [inline]="inline" [dashboardPanel]="panel"  [linkParameters]="panelComponent.parameters"></kervi-widget>
    </ng-container>
</ng-template>